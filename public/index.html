<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLAUDIA Express - Journey Through the Stars</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Ribeye+Marrow&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/sections.css">
    <link rel="stylesheet" href="/css/sections-mobile.css">
    <link rel="stylesheet" href="/css/password-toggle.css">
    <link rel="stylesheet" href="/css/settings-dropdown.css">
    <link rel="stylesheet" href="/css/profile-modal.css">
</head>

<body>
    <!-- Grid Background -->
    <div id="gridContainer" class="grid-container"></div>

    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <div class="logo login-variant">
                    <span class="logo-icon"></span>
                    <div class="logo-text-container">
                        <span class="logo-text-main">
                            <span class="letter letter-c">C</span><span class="letter letter-l">l</span><span
                                class="letter letter-a1">a</span><span class="letter letter-u">u</span><span
                                class="letter letter-d">d</span><span class="letter letter-i">i</span><span
                                class="letter letter-a2">a</span>
                        </span>
                        <span class="logo-text-sub">Gestión-App</span>
                    </div>
                </div>
                <div class="login-security-icon">
                    <span class="padlock-icon">🔒</span>
                </div>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" name="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="password" name="password" required autocomplete="current-password">
                        <button type="button" class="btn-toggle-password"
                            onclick="togglePasswordVisibility('password')">
                            👁️
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn-premium large">
                    <div class="button-outer">
                        <div class="button-inner">
                            <span>Iniciar Viaje 🚀</span>
                        </div>
                    </div>
                </button>
            </form>
        </div>
    </div>

    <!-- Password Change Modal (First Login) -->
    <div id="password-change-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>🔑 Cambio de Contraseña Requerido</h3>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
                    Por seguridad, debes cambiar tu contraseña temporal antes de continuar.
                </p>
                <form id="form-change-password">
                    <input type="hidden" id="temp-user-id">
                    <div class="form-group">
                        <label class="form-label">Contraseña actual</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="current-password" class="form-input" required>
                            <button type="button" class="btn-toggle-password"
                                onclick="togglePasswordVisibility('current-password')">
                                👁️
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nueva contraseña</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="new-password" class="form-input" required>
                            <button type="button" class="btn-toggle-password"
                                onclick="togglePasswordVisibility('new-password')">
                                👁️
                            </button>
                        </div>
                        <small style="color: var(--text-secondary); display: block; margin-top: 0.5rem;">
                            Mínimo 8 caracteres, incluir mayúscula y número
                        </small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirmar contraseña</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="confirm-password" class="form-input" required>
                            <button type="button" class="btn-toggle-password"
                                onclick="togglePasswordVisibility('confirm-password')">
                                👁️
                            </button>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-premium">
                            <div class="button-outer">
                                <div class="button-inner">
                                    <span>Cambiar Contraseña</span>
                                </div>
                            </div>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- User Message Modal (Chat with Admin) -->
    <div id="user-message-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>💬 Chat con Admin</h3>
                <button class="btn-close-modal" onclick="closeUserMessageModal()">✕</button>
            </div>
            <div class="modal-body" style="display: flex; flex-direction: column; height: 500px; padding: 0;">
                <!-- Chat Messages Container -->
                <div class="chat-messages" id="user-chat-messages"
                    style="flex: 1; overflow-y: auto; padding: 1.5rem; background: var(--bg-secondary);">
                    <div class="chat-empty">
                        <p>👋 Cargando mensajes...</p>
                    </div>
                </div>

                <!-- Chat Input -->
                <div style="padding: 1.5rem; border-top: 1px solid var(--border-color); background: var(--bg-primary);">
                    <form id="user-message-form">
                        <div class="form-group" style="margin-bottom: 0.5rem;">
                            <textarea id="user-message-input" class="form-input"
                                placeholder="Escribe tu mensaje al administrador..." rows="3" maxlength="1000" required
                                style="resize: none;"></textarea>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <small style="color: var(--text-secondary);">
                                <span id="user-char-count">0</span>/1000 caracteres
                            </small>
                            <button type="submit" class="btn-premium">
                                <div class="button-outer">
                                    <div class="button-inner">
                                        <span>📤 Enviar</span>
                                    </div>
                                </div>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div id="user-profile-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>👤 Mi Perfil</h3>
                <button class="btn-close-modal" onclick="closeUserProfile()">✕</button>
            </div>
            <div class="modal-body">
                <!-- Profile Tabs -->
                <div class="profile-tabs">
                    <button class="profile-tab active" data-tab="info">📋 Información</button>
                    <button class="profile-tab" data-tab="password">🔑 Contraseña</button>
                    <button class="profile-tab" data-tab="contact">📞 Contacto</button>
                </div>

                <!-- Tab: Information -->
                <div class="profile-tab-content active" id="tab-info">
                    <div class="profile-avatar-section">
                        <div class="current-avatar" id="current-avatar">👤</div>
                        <button class="btn-change-avatar" onclick="showAvatarSelector()">Cambiar Avatar</button>
                    </div>
                    <div class="avatar-selector hidden" id="avatar-selector">
                        <p style="margin-bottom: 1rem; color: var(--text-secondary);">Selecciona un avatar:</p>
                        <div class="avatar-grid">
                            <button class="avatar-option" data-avatar="👤">👤</button>
                            <button class="avatar-option" data-avatar="👨">👨</button>
                            <button class="avatar-option" data-avatar="👩">👩</button>
                            <button class="avatar-option" data-avatar="🧑">🧑</button>
                            <button class="avatar-option" data-avatar="👨‍💼">👨‍💼</button>
                            <button class="avatar-option" data-avatar="👩‍💼">👩‍💼</button>
                            <button class="avatar-option" data-avatar="🧑‍💻">🧑‍💻</button>
                            <button class="avatar-option" data-avatar="👨‍🔧">👨‍🔧</button>
                            <button class="avatar-option" data-avatar="👩‍🔧">👩‍🔧</button>
                            <button class="avatar-option" data-avatar="🦸">🦸</button>
                            <button class="avatar-option" data-avatar="🧙">🧙</button>
                            <button class="avatar-option" data-avatar="🤖">🤖</button>
                        </div>
                    </div>
                    <div class="profile-info-grid">
                        <div class="info-item">
                            <label>Usuario:</label>
                            <span id="profile-username">-</span>
                        </div>
                        <div class="info-item">
                            <label>Rol:</label>
                            <span id="profile-role">-</span>
                        </div>
                        <div class="info-item">
                            <label>Miembro desde:</label>
                            <span id="profile-created">-</span>
                        </div>
                    </div>
                </div>

                <!-- Tab: Password -->
                <div class="profile-tab-content" id="tab-password">
                    <form id="form-profile-password">
                        <div class="form-group">
                            <label class="form-label">Contraseña actual</label>
                            <div class="password-input-wrapper">
                                <input type="password" id="profile-current-password" class="form-input" required>
                                <button type="button" class="btn-toggle-password"
                                    onclick="togglePasswordVisibility('profile-current-password')">👁️</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nueva contraseña</label>
                            <div class="password-input-wrapper">
                                <input type="password" id="profile-new-password" class="form-input" required>
                                <button type="button" class="btn-toggle-password"
                                    onclick="togglePasswordVisibility('profile-new-password')">👁️</button>
                            </div>
                            <small style="color: var(--text-secondary); display: block; margin-top: 0.5rem;">
                                Mínimo 8 caracteres, incluir mayúscula y número
                            </small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confirmar nueva contraseña</label>
                            <div class="password-input-wrapper">
                                <input type="password" id="profile-confirm-password" class="form-input" required>
                                <button type="button" class="btn-toggle-password"
                                    onclick="togglePasswordVisibility('profile-confirm-password')">👁️</button>
                            </div>
                        </div>
                        <button type="submit" class="btn-premium">
                            <div class="button-outer">
                                <div class="button-inner">
                                    <span>Cambiar Contraseña</span>
                                </div>
                            </div>
                        </button>
                    </form>
                </div>

                <!-- Tab: Contact -->
                <div class="profile-tab-content" id="tab-contact">
                    <form id="form-profile-contact">
                        <div class="form-group">
                            <label class="form-label">📱 Teléfono</label>
                            <input type="tel" id="profile-phone" class="form-input" placeholder="+34 123 456 789">
                        </div>
                        <div class="form-group">
                            <label class="form-label">📧 Email</label>
                            <input type="email" id="profile-email" class="form-input" placeholder="usuario@ejemplo.com">
                        </div>
                        <button type="submit" class="btn-premium">
                            <div class="button-outer">
                                <div class="button-inner">
                                    <span>Guardar Cambios</span>
                                </div>
                            </div>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Intro Overlay -->
    <div id="intro-overlay" class="intro-overlay hidden">
        <div class="intro-content">
            <!-- Loading Screen with Percentage -->
            <div class="intro-loader" id="intro-loader">
                <div class="loader-spinner"></div>
                <p class="loader-percentage" id="loader-percentage">0%</p>
                <p class="loader-text">Cargando...</p>
            </div>

            <!-- Welcome Message (appears below loader) -->
            <div class="intro-welcome hidden" id="intro-welcome">
                <h1 class="welcome-title">¡Bienvenido, <span id="welcome-username"></span>!</h1>
                <p class="welcome-subtitle">Preparando tu espacio de trabajo</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="main-app hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon"></span>
                    <div class="logo-text-container">
                        <span class="logo-text-main"><span class="letter letter-c">C</span><span
                                class="letter letter-l">l</span><span class="letter letter-a1">a</span><span
                                class="letter letter-u">u</span><span class="letter letter-d">d</span><span
                                class="letter letter-i">i</span><span class="letter letter-a2">a</span></span>
                        <span class="logo-text-sub">Gestión-App</span>
                    </div>
                </div>
                <div class="quick-actions">
                    <!-- Theme Toggle Button -->
                    <button class="btn-premium small" id="btn-theme-toggle" title="Cambiar tema">
                        <div class="button-outer">
                            <div class="button-inner">
                                <span id="theme-icon">☀️</span>
                                <span id="theme-text">Día</span>
                            </div>
                        </div>
                    </button>

                    <button class="btn-premium small" id="btn-profile">
                        <div class="button-outer">
                            <div class="button-inner">
                                <span id="user-name">👤 Usuario</span>
                            </div>
                        </div>
                    </button>

                    <!-- Settings Dropdown -->
                    <div class="settings-dropdown-container">
                        <button class="btn-premium small" id="btn-settings">
                            <div class="button-outer">
                                <div class="button-inner">
                                    <span>⚙️ Tools</span>
                                </div>
                            </div>
                        </button>
                        <div class="settings-dropdown hidden" id="settings-dropdown">
                            <button class="settings-option" data-action="theme">
                                <span class="option-icon">🌓</span>
                                <span class="option-text">Claro/Oscuro</span>
                            </button>
                            <button class="settings-option" data-action="color">
                                <span class="option-icon">🎨</span>
                                <span class="option-text">Color</span>
                            </button>
                            <button class="settings-option" data-action="message">
                                <span class="option-icon">💬</span>
                                <span class="option-text">Mensaje al Admin</span>
                                <span class="message-badge-small hidden" id="message-badge-small">0</span>
                            </button>
                        </div>
                    </div>

                    <button class="btn-premium small" id="btn-logout">
                        <div class="button-outer">
                            <div class="button-inner">
                                <span>🚪 Salir</span>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
        </header>

        <!-- Dashboard -->
        <main class="dashboard">
            <h1 class="dashboard-title">Centro de Control</h1>
            <p class="dashboard-subtitle">Selecciona tu destino en el cosmos</p>

            <div class="dashboard-grid">
                <!-- Card 1: Registro -->
                <div class="dashboard-card" data-section="registro">
                    <div class="card-icon">⏱️</div>
                    <h2 class="card-title">Registro de Horas</h2>
                    <p class="card-description">Registra tus horas de trabajo y despega hacia nuevas aventuras</p>
                </div>

                <!-- Card 2: Lista -->
                <div class="dashboard-card" data-section="lista">
                    <div class="card-icon">📋</div>
                    <h2 class="card-title">Lista de Registros</h2>
                    <p class="card-description">Explora tu historial de registros en la galaxia del tiempo</p>
                </div>

                <!-- Card 3: Búsqueda Avanzada -->
                <div class="dashboard-card" data-section="busqueda">
                    <div class="card-icon">🔍</div>
                    <h2 class="card-title">Búsqueda Avanzada</h2>
                    <p class="card-description">Encuentra registros con filtros y exporta resultados</p>
                </div>

                <!-- Card 4: Usuarios (Admin only) -->
                <div class="dashboard-card hidden" id="card-users" data-section="usuarios">
                    <div class="card-icon">👥</div>
                    <h2 class="card-title">Gestión Admin</h2>
                    <p class="card-description">Administra la tripulación de tu nave espacial</p>
                </div>
            </div>
        </main>

        <!-- Sections Container (will be loaded dynamically) -->
        <div id="sections-container" class="sections-container">
            <!-- Las secciones se cargarán aquí dinámicamente -->
        </div>
    </div>

    <!-- Message Toast -->
    <div id="message-toast" class="toast hidden"></div>

    <!-- jsPDF Library for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script src="/js/history-manager.js"></script>
    <script src="/js/app.js"></script>
    <script src="/js/sections.js"></script>
    <script src="/js/usuarios.js"></script>
    <script src="/js/mensajes.js"></script>
</body>

</html>