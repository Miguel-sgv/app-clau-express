<link rel="stylesheet" href="/css/security-panel.css">

<!-- Secci√≥n: Gesti√≥n de Usuarios -->
<section id="section-usuarios" class="section-view">
    <div class="section-container">
        <!-- Header de la secci√≥n -->
        <div class="section-header">
            <button class="btn-back" id="btn-back-usuarios">
                <span>‚Üê Volver</span>
            </button>
            <h1 class="section-title">üîê Panel de Seguridad</h1>
        </div>

        <!-- Security Dashboard Grid -->
        <div class="security-dashboard">
            <!-- Card: Gesti√≥n de Usuarios -->
            <div class="security-card" id="card-user-management">
                <div class="security-card-icon">üë•</div>
                <h2 class="security-card-title">Gesti√≥n de Usuarios</h2>
                <p class="security-card-description">Crear, editar y administrar usuarios del sistema</p>
                <button class="btn-security-action" data-action="user-management">
                    <span>Acceder</span>
                </button>
            </div>

            <!-- Card: Crear Usuario -->
            <div class="security-card" id="card-create-user">
                <div class="security-card-icon">‚ûï</div>
                <h2 class="security-card-title">Crear Usuario</h2>
                <p class="security-card-description">Registrar nuevo usuario en el sistema</p>
                <button class="btn-security-action" data-action="create-user">
                    <span>Crear</span>
                </button>
            </div>

            <!-- Card: Registro de Accesos -->
            <div class="security-card" id="card-access-logs">
                <div class="security-card-icon">üìä</div>
                <h2 class="security-card-title">Registro de Accesos</h2>
                <p class="security-card-description">Historial de inicios y cierres de sesi√≥n</p>
                <button class="btn-security-action" data-action="access-logs">
                    <span>Ver Logs</span>
                </button>
            </div>

            <!-- Card: Registro de Modificaciones -->
            <div class="security-card" id="card-modification-logs">
                <div class="security-card-icon">üìù</div>
                <h2 class="security-card-title">Registro de Modificaciones</h2>
                <p class="security-card-description">Historial de cambios en registros de usuarios</p>
                <button class="btn-security-action" data-action="modification-logs">
                    <span>Ver Logs</span>
                </button>
            </div>

            <!-- Card: Mensajes -->
            <div class="security-card" id="card-messages">
                <div class="security-card-icon">üí¨</div>
                <h2 class="security-card-title">Mensajes de Usuarios</h2>
                <p class="security-card-description">Comunicaci√≥n con usuarios del sistema</p>
                <button class="btn-security-action" data-action="messages">
                    <span>Ver Mensajes</span>
                </button>
            </div>
        </div>

        <!-- Panel: User Management (Hidden by default) -->
        <div id="panel-user-management" class="security-panel hidden">
            <div class="panel-header">
                <h2>üë• Gesti√≥n de Usuarios</h2>
                <button class="btn-back-panel">‚Üê Volver al Panel</button>
            </div>

            <div class="form-card">
                <div class="table-container">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Rol</th>
                                <th>Estado</th>
                                <th>√öltimo Acceso</th>
                                <th>Accesos</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody">
                            <tr class="loading-row">
                                <td colspan="6" style="text-align: center; padding: 2rem;">
                                    Cargando usuarios...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Panel: Access Logs (Hidden by default) -->
        <div id="panel-access-logs" class="security-panel hidden">
            <div class="panel-header">
                <h2>üìä Registro de Accesos</h2>
                <button class="btn-back-panel">‚Üê Volver al Panel</button>
            </div>

            <div class="form-card">
                <div class="table-container">
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Acci√≥n</th>
                                <th>Fecha/Hora</th>
                                <th>IP</th>
                            </tr>
                        </thead>
                        <tbody id="access-logs-tbody">
                            <tr class="loading-row">
                                <td colspan="4" style="text-align: center; padding: 2rem;">
                                    Cargando logs...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Panel: Modification Logs (Hidden by default) -->
        <div id="panel-modification-logs" class="security-panel hidden">
            <div class="panel-header">
                <h2>üìù Registro de Modificaciones</h2>
                <button class="btn-back-panel">‚Üê Volver al Panel</button>
            </div>

            <div class="form-card">
                <div class="table-container">
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>Admin</th>
                                <th>Usuario Afectado</th>
                                <th>Acci√≥n</th>
                                <th>Fecha/Hora</th>
                                <th>Detalles</th>
                            </tr>
                        </thead>
                        <tbody id="modification-logs-tbody">
                            <tr class="loading-row">
                                <td colspan="5" style="text-align: center; padding: 2rem;">
                                    Cargando logs...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Modal: Crear Usuario -->
        <div id="modal-create-user" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚ûï Crear Nuevo Usuario</h3>
                    <button class="btn-close-modal">‚úï</button>
                </div>
                <div class="modal-body">
                    <form id="form-create-user">
                        <div class="form-group">
                            <label class="form-label">Nombre de usuario</label>
                            <input type="text" name="username" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contrase√±a temporal</label>
                            <input type="text" name="password" class="form-input" value="Pass1234!" readonly>
                            <small style="color: var(--text-secondary); display: block; margin-top: 0.5rem;">
                                El usuario deber√° cambiarla en el primer login
                            </small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tel√©fono (opcional)</label>
                            <input type="tel" name="phone" class="form-input" placeholder="+34 123 456 789">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email (opcional)</label>
                            <input type="email" name="email" class="form-input" placeholder="usuario@ejemplo.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Rol</label>
                            <select name="role" class="form-select" id="role-select">
                                <option value="user">Usuario</option>
                                <option value="supervisor" class="admin-only-option">Supervisor</option>
                                <option value="admin" class="admin-only-option">Administrador</option>
                            </select>
                            <small style="color: var(--text-secondary); display: block; margin-top: 0.5rem;"
                                id="role-help-text">
                                Solo el administrador principal puede crear supervisores y administradores
                            </small>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-premium">
                                <div class="button-outer">
                                    <div class="button-inner">
                                        <span>Crear Usuario</span>
                                    </div>
                                </div>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal: User Actions Menu -->
        <div id="modal-user-actions" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Acciones de Usuario</h3>
                    <button class="btn-close-modal">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="user-actions-menu">
                        <button class="btn-user-action" data-action="view-records">
                            üìä Ver Registros
                        </button>
                        <button class="btn-user-action" data-action="toggle-status">
                            üîí Bloquear/Desbloquear
                        </button>
                        <button class="btn-user-action" data-action="change-role">
                            üë§ Cambiar Rol
                        </button>
                        <button class="btn-user-action" data-action="reset-password">
                            üîë Resetear Contrase√±a
                        </button>
                        <button class="btn-user-action danger" data-action="delete">
                            üóëÔ∏è Eliminar Usuario
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal: Change User Role -->
        <div id="modal-change-role" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üë§ Cambiar Rol de Usuario</h3>
                    <button class="btn-close-modal">‚úï</button>
                </div>
                <div class="modal-body">
                    <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
                        Usuario: <strong id="change-role-username"></strong>
                    </p>
                    <form id="form-change-role">
                        <div class="form-group">
                            <label class="form-label">Nuevo Rol:</label>
                            <select name="role" id="change-role-select" class="form-select" required>
                                <option value="user">Usuario</option>
                                <option value="supervisor">Supervisor</option>
                                <option value="admin">Administrador</option>
                            </select>
                            <small style="color: var(--text-secondary); display: block; margin-top: 0.5rem;">
                                <strong>Usuario:</strong> Sin acceso al panel de administraci√≥n<br>
                                <strong>Supervisor:</strong> Puede gestionar usuarios pero no crear admin/supervisor<br>
                                <strong>Admin:</strong> Permisos completos
                            </small>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-premium">
                                <div class="button-outer">
                                    <div class="button-inner">
                                        <span>Cambiar Rol</span>
                                    </div>
                                </div>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal: User Records -->
        <div id="modal-user-records" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content large">
                <div class="modal-header">
                    <h3>üìä Registros de <span id="user-records-username"></span></h3>
                    <button class="btn-close-modal">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="table-container">
                        <table class="records-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Parador</th>
                                    <th>Inicio</th>
                                    <th>Fin</th>
                                    <th>Total</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="user-records-tbody">
                                <tr class="loading-row">
                                    <td colspan="6" style="text-align: center; padding: 2rem;">
                                        Cargando registros...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>